<%- include('partials/header') %>

<div class="loading-container">
    <div class="loader"></div>
    <h2>Generating "<%= title %>"</h2>
    
    <div class="tips-container">
        <h3>Pro Tips:</h3>
        <ul id="tips-list">
            <% tips.forEach((tip, index) => { %>
                <li class="tip" style="display: <%= index === 0 ? 'block' : 'none' %>"><%= tip %></li>
            <% }); %>
        </ul>
    </div>

    <p class="status">Constructing game logic...</p>
</div>

<script>
    // Cycle tips
    const tips = document.querySelectorAll('.tip');
    let currentTip = 0;
    setInterval(() => {
        tips[currentTip].style.display = 'none';
        currentTip = (currentTip + 1) % tips.length;
        tips[currentTip].style.display = 'block';
    }, 3000);

    // Start generation
    async function startGeneration() {
        try {
            const response = await fetch('/api/create-game', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    title: "<%= title %>",
                    tags: "<%= tags %>",
                    prompt: "<%= prompt %>",
                    type: "<%= type %>"
                })
            });

            if (!response.ok) {
                throw new Error('Generation failed');
            }

            const data = await response.json();
            window.location.href = `/play/${data.id}`;
        } catch (error) {
            document.querySelector('.status').innerText = "Error generating game. Please try again.";
            document.querySelector('.status').style.color = "red";
            console.error(error);
        }
    }

    // Start immediately
    startGeneration();
</script>

<style>
    .loading-container {
        text-align: center;
        padding: 4rem 2rem;
        max-width: 600px;
        margin: 0 auto;
    }

    .loader {
        border: 8px solid #f3f3f3;
        border-top: 8px solid #3498db;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 2s linear infinite;
        margin: 0 auto 2rem auto;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .tips-container {
        background: #fff;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin: 2rem 0;
        min-height: 150px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .tips-container h3 {
        color: #7f8c8d;
        margin-top: 0;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .tip {
        font-size: 1.2rem;
        font-style: italic;
        color: #2c3e50;
    }
</style>

<%- include('partials/footer') %>
